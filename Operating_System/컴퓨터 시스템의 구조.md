# Operating System / 컴퓨터 시스템의 구조
OS 2단원 컴퓨터 시스템의 구조   
   
## 운영체제에게 CPU가 넘어가는 경우는 언젠가요?
여려 경우가 있지만 공통적으로는 인터럽트 라인을 세팅하는 경우입니다.   
인트럽트 라인은 소프트웨어 중심과 하드웨어 중심이 있는데, 그 중에서 시스템 콜을 통해 운영체제에게 CPU를 넘깁니다.   
   
## 인터럽트는 무엇인가요?
CPU가 프로그램을 실행하고 있을 때, 입출력 하드웨어 등의 장치에서 이슈나 예외 상황이 발생하여 처리가 필요할 경우에 CPU에 알려서 처리하는 기술을 말합니다.   
어느 한 순간 CPU가 실행하는 명령은 하나이지만 다른 장치와 커뮤니케이션을 할 수 있는 것은 인트럽트를 통해 소프트웨어나 하드웨어가 신호를 보내서 CPU와 커뮤니케이션이 가능한 것.   
CPU는 매번 명령을 수행하기 전 인터럽트 라인이 셋팅되어있는지 확인합니다.   
   
## 인터럽트의 종류
- **하드웨어 인터럽트**   
하드웨어(ex. I/O)가 발생시킨 인터럽트로, CPU가 아닌 다른 하드웨어 장치가 CPU에 어떤 사실을 알려주거나 CPU 서비스를 요청해야할 때   
    
- **소프트웨어 인터럽트**   
하드웨어 작업이 필요할 때 OS가 발생시킨 인터럽트로, 스스로 인터럽트 라인을 생성하며, 보통 시스템 콜이나 예외 상황때 발생   
   
## 인터럽트와 시스템 콜 차이점은 무엇인가요?
시스템 콜은 인트럽트의 일종입니다.   
시스템 콜은 운영체제의 커널이 제공하는 서비스에 대해 응용 프로그램의 요청에 따라 커널에 접근하기 위한 인터페이스이며, 인트럽트란 CPU가 프로그램을 실행할 때 입출력 하드웨어 장치등 예외상황이 발생하여 처리가 필요할 경우에 마이크로프로세서에게 알려 처리할 수 있도록 하는 것을 말합니다.   
(I/O가 시작할 땐 소프트웨어 인트럽트, I/O가 끝날땐 하드웨어 인트럽트)   
   
## 인터럽트 핸들링 과정을 설명해주세요.
프로그램 A가 수행중에 인터럽트가 발생하면 현재까지 수행된 지점을 프로세스 제어 블록(PCB)에 저장하고, 인터럽트 처리 루틴으로 와서 커널 코드를 수행하게 되며, 이때 이루어지는 함수 호출은 프로세스 A의 커널 스택을 사용하게 된다.   
인터럽트 처리가 끝마쳐진 후에는 PCB에 저장된 주소로 되돌아가서 중지된 작업의 나머지 부분을 수행하게 된다.   
   
## mode bit이란 무엇인가요?
사용자 프로그램의 잘못된 수행으로 다른 프로그램 및 운영체제에 피해가 가지 않도록 하기위한 보호장치이다.   
사용자 프로그램을 실행할 때에는 mode bit가 1이 되며, 특권명령을 실행하지 못합니다.   
특권명령을 실행하기 위해선 cpu가 자동적으로 운영체제에게 넘어갑니다.   
이 때 mode bit이 0이되며, 모니터 모드(관리자 모드 or 커널 모드)가 됩니다.   
   
- 왜 mode bit을 통해 모드를 구분했을까?   
사용자가 하드웨어의 자원에 접근하는 것은 매우 위험한 행위이므로, 이러한 경우에는 관리자 모드로 운영체제에서 처리하도록 하는 것이다.   
(사용자 프로그램에서 소프트웨어 인트럽트를 발생시켜 운영체제에게 위임)   
   
- 커널 모드에서는 일반명령을 수행하는지 못하는가?   
결론부터 말하면 아니다.   
커널 모드에서는 일반 명령, 특권 명령 모두 수행이 가능하다.   
   
## 특권 명령과 일반 명령이란?
**일반 명령**   
메모리에서 자료를 read, CPU에서는 계산하는 등의 명령이며, 모든 프로그램이 수행할 수 있는 명령이다.   
   
**특권 명령**   
보안이 필요한 명령으로 입출력 장치, 타이머 등의 장치를 접근하는 명령이다.   
특권 명령을 오직 운영체제만이 수행할 수 있다.   
   
## DMA를 설명하시오.
- 고속 I/O장치는 CPU에 매번 interrupt를 걸고 실행하게 되면 비효율적이다. 이러한 비효율성을 극복하기 위해 CPU 이외에 메모리 접근이 가능한 장치를 하나 더 두게 되는데 이를 DMA(Direct Memory Access)라고 한다.
- DMA는 일종의 컨트롤러로서 CPU가 주변 장치들의 메모리 접근 요청에 의해 자주 인터럽트 당하는 것을 막아준다.
- DMA는 블록이라는 큰 단위로 정보를 메모리로 읽어온 후에 CPU에게 인터럽트를 발생시켜 해당 작업의 완료를 알려준다. 이러한 방식으로 CPU에 발생하는 인터럽트의 빈도를 줄여 CPU를 좀더 유용하게 사용하고 입출력 연산을 더욱 빠르게 수행할 수 있다.

## 커널 주소공간에 대해
**code**   
- 시스템콜, 인터럽트 처리 코드
- 자원 관리를 위한 코드
   
**data**   
- 프로세스들의 PCB와, CPU, 메모리, 디스크에 대한 중요 data들이 저장돼있다.
   
**stack**   
- 프로세스별로 별도의 stack을 가지며, 커널코드의 함수를 호출해 어디로 돌아갈지 저장된다.
